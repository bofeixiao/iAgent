# iData AI创作平台 - 部署文档

## 1. 环境要求

### 1.1 服务器配置
- **CPU**: 4核+
- **内存**: 8GB+
- **硬盘**: 100GB+
- **操作系统**: CentOS 7+/Ubuntu 20.04+

### 1.2 软件环境
- **JDK**: 17+
- **Maven**: 3.8+
- **Node.js**: 18+
- **MySQL**: 8.0+
- **Redis**: 7.x
- **RabbitMQ**: 3.12+
- **Nginx**: 1.24+
- **Docker**: 24.x (可选)
- **Docker Compose**: 2.x (可选)

## 2. 数据库部署

### 2.1 MySQL安装

```bash
# CentOS/RHEL
sudo yum install mysql-server
sudo systemctl start mysqld
sudo systemctl enable mysqld

# Ubuntu/Debian
sudo apt-get update
sudo apt-get install mysql-server
sudo systemctl start mysql
sudo systemctl enable mysql
```

### 2.2 创建数据库

```bash
# 登录MySQL
mysql -u root -p

# 执行初始化脚本
source /path/to/idata-ai-platform/database/schema/init.sql
```

### 2.3 Redis安装

```bash
# CentOS/RHEL
sudo yum install redis
sudo systemctl start redis
sudo systemctl enable redis

# Ubuntu/Debian
sudo apt-get install redis-server
sudo systemctl start redis
sudo systemctl enable redis
```

### 2.4 RabbitMQ安装

```bash
# 使用Docker安装(推荐)
docker run -d --name rabbitmq \
  -p 5672:5672 \
  -p 15672:15672 \
  -e RABBITMQ_DEFAULT_USER=admin \
  -e RABBITMQ_DEFAULT_PASS=admin123 \
  rabbitmq:3.12-management
```

## 3. 后端部署

### 3.1 编译打包

```bash
cd backend
mvn clean package -DskipTests
```

### 3.2 配置文件

修改各服务的 `application.yml`:

```yaml
spring:
  datasource:
    url: jdbc:mysql://your-mysql-host:3306/idata_ai
    username: your-username
    password: your-password
  
  redis:
    host: your-redis-host
    port: 6379
    password: your-redis-password
```

### 3.3 启动服务

```bash
# 方式1: 直接运行jar
java -jar idata-auth/target/idata-auth-1.0.0.jar

# 方式2: 使用脚本
./deployment/scripts/startup.sh

# 方式3: 使用Docker Compose
cd deployment/docker
docker-compose up -d
```

## 4. 前端部署

### 4.1 安装依赖

```bash
cd frontend
npm install
```

### 4.2 构建生产版本

```bash
npm run build
```

### 4.3 Nginx配置

创建 `/etc/nginx/conf.d/idata-ai.conf`:

```nginx
server {
    listen 80;
    server_name your-domain.com;

    # 前端静态文件
    location / {
        root /var/www/idata-ai-platform/frontend/dist;
        try_files $uri $uri/ /index.html;
    }

    # API代理
    location /api/ {
        proxy_pass http://localhost:8080/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
```

### 4.4 启动Nginx

```bash
sudo nginx -t
sudo systemctl restart nginx
```

## 5. Docker Compose部署(推荐)

### 5.1 docker-compose.yml

```yaml
version: '3.8'

services:
  mysql:
    image: mysql:8.0
    container_name: idata-mysql
    environment:
      MYSQL_ROOT_PASSWORD: root123
      MYSQL_DATABASE: idata_ai
    ports:
      - "3306:3306"
    volumes:
      - mysql-data:/var/lib/mysql
      - ./database/schema:/docker-entrypoint-initdb.d
    networks:
      - idata-network

  redis:
    image: redis:7-alpine
    container_name: idata-redis
    ports:
      - "6379:6379"
    networks:
      - idata-network

  rabbitmq:
    image: rabbitmq:3.12-management
    container_name: idata-rabbitmq
    environment:
      RABBITMQ_DEFAULT_USER: admin
      RABBITMQ_DEFAULT_PASS: admin123
    ports:
      - "5672:5672"
      - "15672:15672"
    networks:
      - idata-network

  backend:
    build: ./backend
    container_name: idata-backend
    ports:
      - "8080-8087:8080-8087"
    depends_on:
      - mysql
      - redis
      - rabbitmq
    networks:
      - idata-network

  frontend:
    build: ./frontend
    container_name: idata-frontend
    ports:
      - "80:80"
    depends_on:
      - backend
    networks:
      - idata-network

volumes:
  mysql-data:

networks:
  idata-network:
    driver: bridge
```

### 5.2 启动所有服务

```bash
cd deployment/docker
docker-compose up -d
```

### 5.3 查看日志

```bash
docker-compose logs -f
```

## 6. 验证部署

### 6.1 检查服务状态

```bash
# 检查后端服务
curl http://localhost:8081/api/auth/info

# 检查数据库连接
mysql -h localhost -u root -p idata_ai -e "SELECT COUNT(*) FROM t_user;"

# 检查Redis
redis-cli ping
```

### 6.2 访问应用

- **前端**: http://your-domain.com
- **RabbitMQ管理**: http://your-domain.com:15672

## 7. 监控与运维

### 7.1 日志查看

```bash
# 后端日志
tail -f logs/idata-auth.log

# Nginx日志
tail -f /var/log/nginx/access.log
tail -f /var/log/nginx/error.log
```

### 7.2 备份数据库

```bash
# 每日备份脚本
./deployment/scripts/backup.sh
```

### 7.3 性能监控

建议使用:
- **Prometheus + Grafana**: 系统监控
- **ELK Stack**: 日志分析
- **SkyWalking**: APM监控

---

**文档版本**: v1.0  
**更新日期**: 2026-02-15  
**技术支持**: iDataAI团队
