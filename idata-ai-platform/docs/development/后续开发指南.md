# åç»­å¼€å‘æŒ‡å—

**æœ¬æ–‡æ¡£æä¾›iData AIåˆ›ä½œå¹³å°åç»­å¼€å‘çš„è¯¦ç»†æŒ‡å¼•ã€‚**

> ğŸ“Œ **ç›¸å…³æ–‡æ¡£**:
> - ğŸš€ éƒ¨ç½²æ–‡æ¡£ â†’ [é¡¹ç›®æ€»è§ˆ](../PROJECT_OVERVIEW.md) | [å¿«é€Ÿå¼€å§‹](../../QUICK_START.md)
> - ğŸ”§ é…ç½®å‚è€ƒ â†’ [é…ç½®å‚è€ƒæ‰‹å†Œ](../deployment/é…ç½®å‚è€ƒæ‰‹å†Œ.md)
> - âœ… å·²å®ç°åŠŸèƒ½ â†’ [é¡¹ç›®æ€»è§ˆ#ğŸ¯-æ ¸å¿ƒåŠŸèƒ½](../PROJECT_OVERVIEW.md)

## ğŸ“‹ å¼€å‘è®¡åˆ’

### é˜¶æ®µä¸€: å®Œæˆæ ¸å¿ƒæœåŠ¡ (ä¼˜å…ˆçº§: é«˜)

#### 1. å®Œæˆè®¤è¯æœåŠ¡ (idata-auth)

**å¾…å®ç°:**
- [ ] AuthServiceImpl - ç™»å½•/æ³¨å†Œ/ç™»å‡ºé€»è¾‘
- [ ] UserMapper - ç”¨æˆ·æ•°æ®è®¿é—®
- [ ] User Entity - ç”¨æˆ·å®ä½“ç±»
- [ ] MyBatis XMLæ˜ å°„æ–‡ä»¶

**å‚è€ƒä»£ç :**

```java
// UserMapper.java
@Mapper
public interface UserMapper extends BaseMapper<User> {
    User selectByEmail(String email);
    User selectByPhone(String phone);
}

// AuthServiceImpl.java
@Service
public class AuthServiceImpl implements AuthService {
    @Autowired
    private UserMapper userMapper;
    
    @Autowired
    private JwtUtil jwtUtil;
    
    @Autowired
    private RedisService redisService;
    
    @Override
    @Transactional
    public LoginVO login(LoginDTO loginDTO) {
        // 1. æŸ¥è¯¢ç”¨æˆ·
        User user = userMapper.selectByEmail(loginDTO.getAccount());
        if (user == null) {
            user = userMapper.selectByPhone(loginDTO.getAccount());
        }
        
        // 2. éªŒè¯å¯†ç 
        if (!PasswordUtil.matches(loginDTO.getPassword(), user.getPassword())) {
            throw new BusinessException(ErrorCode.PASSWORD_ERROR);
        }
        
        // 3. ç”ŸæˆToken
        String token = jwtUtil.generateToken(user.getId(), user.getUsername());
        
        // 4. ç¼“å­˜åˆ°Redis
        redisService.setEx(RedisKeyConstants.getTokenKey(token), 
                          user.getId(), 
                          RedisKeyConstants.TOKEN_EXPIRE_TIME);
        
        // 5. æ„é€ è¿”å›ç»“æœ
        return buildLoginVO(user, token);
    }
}
```

#### 2. å¼€å‘ç³»ç»Ÿç®¡ç†æœåŠ¡ (idata-system)

**æ ¸å¿ƒåŠŸèƒ½:**
- ç”¨æˆ·ç®¡ç† (CRUD)
- è§’è‰²ç®¡ç†
- é…ç½®ç®¡ç†
- æ“ä½œæ—¥å¿—

**POMæ–‡ä»¶:** å‚è€ƒ idata-auth/pom.xml

**ç›®å½•ç»“æ„:**
```
idata-system/
â”œâ”€â”€ src/main/java/com/idataai/system/
â”‚   â”œâ”€â”€ SystemApplication.java
â”‚   â”œâ”€â”€ controller/
â”‚   â”‚   â”œâ”€â”€ UserController.java
â”‚   â”‚   â”œâ”€â”€ RoleController.java
â”‚   â”‚   â””â”€â”€ ConfigController.java
â”‚   â”œâ”€â”€ service/
â”‚   â”‚   â”œâ”€â”€ IUserService.java
â”‚   â”‚   â””â”€â”€ impl/UserServiceImpl.java
â”‚   â”œâ”€â”€ mapper/
â”‚   â”‚   â””â”€â”€ UserMapper.java
â”‚   â””â”€â”€ domain/
â”‚       â”œâ”€â”€ entity/User.java
â”‚       â”œâ”€â”€ dto/UserDTO.java
â”‚       â””â”€â”€ vo/UserVO.java
â””â”€â”€ src/main/resources/
    â”œâ”€â”€ application.yml
    â””â”€â”€ mapper/UserMapper.xml
```

#### 3. å¼€å‘åº”ç”¨æœåŠ¡ (idata-app)

**æ ¸å¿ƒåŠŸèƒ½:**
- åº”ç”¨æ¨¡æ¿åˆ—è¡¨
- åº”ç”¨è¯¦æƒ…
- åˆ›å»ºå®ä¾‹
- å®ä¾‹ç®¡ç†

**å…³é”®æ¥å£:**
```java
@RestController
@RequestMapping("/api/app")
public class ApplicationController {
    
    @GetMapping("/list")
    public Result<PageResult<ApplicationVO>> list(ApplicationQueryDTO queryDTO) {
        // åˆ†é¡µæŸ¥è¯¢åº”ç”¨åˆ—è¡¨
    }
    
    @PostMapping("/instance/create")
    public Result<InstanceVO> createInstance(@RequestBody InstanceCreateDTO dto) {
        // åˆ›å»ºAIå®ä¾‹,å‘é€åˆ°MQå¼‚æ­¥å¤„ç†
    }
}
```

**MQæ¶ˆæ¯å¤„ç†:**
```java
@Component
public class InstanceConsumer {
    
    @RabbitListener(queues = RabbitMQConfig.AI_TASK_QUEUE)
    public void handleAiTask(InstanceCreateDTO dto) {
        // 1. è°ƒç”¨AIæœåŠ¡ç”Ÿæˆå†…å®¹
        // 2. ä¿å­˜ç»“æœ
        // 3. æ‰£é™¤ç§¯åˆ†
        // 4. æ›´æ–°å®ä¾‹çŠ¶æ€
    }
}
```

### é˜¶æ®µäºŒ: å¼€å‘ä¸šåŠ¡æœåŠ¡ (ä¼˜å…ˆçº§: ä¸­)

#### 4. å†…å®¹æœåŠ¡ (idata-content)
- æ–‡ç« ç®¡ç†
- æ€ç»´åˆ†æ

#### 5. æ”¯ä»˜æœåŠ¡ (idata-payment)
- ä¼šå‘˜è´­ä¹°
- ç§¯åˆ†å……å€¼
- è®¢å•ç®¡ç†

#### 6. è¥é”€æœåŠ¡ (idata-marketing)
- æ´»åŠ¨ç®¡ç†
- é‚€è¯·å¥–åŠ±
- çƒ­ç‚¹è¶‹åŠ¿

### é˜¶æ®µä¸‰: AIé›†æˆä¸ç½‘å…³ (ä¼˜å…ˆçº§: ä¸­)

#### 7. AIæœåŠ¡ (idata-ai)

**é›†æˆOpenAI:**
```java
@Service
public class OpenAiService {
    
    @Value("${openai.api-key}")
    private String apiKey;
    
    public String generateText(String prompt) {
        // è°ƒç”¨OpenAI API
        // ä½¿ç”¨ RestTemplate æˆ– WebClient
    }
}
```

#### 8. ç½‘å…³æœåŠ¡ (idata-gateway)

**Spring Cloud Gatewayé…ç½®:**
```yaml
spring:
  cloud:
    gateway:
      routes:
        - id: auth-service
          uri: lb://idata-auth
          predicates:
            - Path=/api/auth/**
        - id: app-service
          uri: lb://idata-app
          predicates:
            - Path=/api/app/**
```

## ğŸ¨ å‰ç«¯å¼€å‘

### 1. åˆ›å»ºå¸ƒå±€ç»„ä»¶

**DefaultLayout.vue:**
```vue
<template>
  <div class="layout">
    <el-container>
      <el-header>
        <Header />
      </el-header>
      <el-main>
        <router-view />
      </el-main>
      <el-footer>
        <Footer />
      </el-footer>
    </el-container>
  </div>
</template>
```

### 2. å¼€å‘æ ¸å¿ƒé¡µé¢

#### ç™»å½•é¡µé¢ (views/auth/Login.vue)
```vue
<template>
  <div class="login-page">
    <el-form :model="loginForm" :rules="rules" ref="formRef">
      <el-form-item prop="account">
        <el-input v-model="loginForm.account" placeholder="é‚®ç®±/æ‰‹æœºå·" />
      </el-form-item>
      <el-form-item prop="password">
        <el-input v-model="loginForm.password" type="password" placeholder="å¯†ç " />
      </el-form-item>
      <el-button type="primary" @click="handleLogin">ç™»å½•</el-button>
    </el-form>
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue'
import { useRouter } from 'vue-router'
import { useUserStore } from '@/stores/user'
import type { FormInstance } from 'element-plus'

const router = useRouter()
const userStore = useUserStore()
const formRef = ref<FormInstance>()

const loginForm = ref({
  account: '',
  password: ''
})

const handleLogin = async () => {
  await formRef.value?.validate()
  await userStore.login(loginForm.value)
  router.push('/')
}
</script>
```

#### åº”ç”¨åˆ—è¡¨é¡µé¢ (views/application/List.vue)
```vue
<template>
  <div class="app-list">
    <div class="app-grid">
      <AppCard 
        v-for="app in appList" 
        :key="app.id" 
        :app="app" 
        @click="handleAppClick(app)"
      />
    </div>
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted } from 'vue'
import { getApplicationList } from '@/api/modules/application'
import AppCard from '@/components/business/AppCard/index.vue'

const appList = ref([])

const fetchList = async () => {
  const res = await getApplicationList({ current: 1, size: 20 })
  appList.value = res.data.records
}

onMounted(() => {
  fetchList()
})
</script>
```

### 3. åˆ›å»ºä¸šåŠ¡ç»„ä»¶

#### AppCardç»„ä»¶ (components/business/AppCard/index.vue)
```vue
<template>
  <el-card class="app-card" @click="$emit('click')">
    <div class="app-icon">{{ app.appIcon }}</div>
    <div class="app-name">{{ app.appName }}</div>
    <div class="app-desc">{{ app.description }}</div>
    <div class="app-footer">
      <span>{{ app.creditsCost }} ç§¯åˆ†</span>
      <span>{{ app.useCount }} æ¬¡ä½¿ç”¨</span>
    </div>
  </el-card>
</template>

<script setup lang="ts">
defineProps<{
  app: any
}>()

defineEmits<{
  (e: 'click'): void
}>()
</script>
```

## ğŸ—„ï¸ å®Œå–„æ•°æ®åº“

### æ·»åŠ å®Œæ•´çš„è¡¨ç»“æ„

åœ¨ `database/schema/` ç›®å½•ä¸‹åˆ›å»º:
- `02_content_tables.sql` - å†…å®¹ç›¸å…³è¡¨
- `03_payment_tables.sql` - æ”¯ä»˜ç›¸å…³è¡¨
- `04_marketing_tables.sql` - è¥é”€ç›¸å…³è¡¨
- `05_system_tables.sql` - ç³»ç»Ÿç›¸å…³è¡¨

### æ·»åŠ æµ‹è¯•æ•°æ®

åœ¨ `database/data/` ç›®å½•ä¸‹åˆ›å»º:
- `01_test_users.sql` - æµ‹è¯•ç”¨æˆ·
- `02_test_applications.sql` - æµ‹è¯•åº”ç”¨
- `03_test_articles.sql` - æµ‹è¯•æ–‡ç« 

## ğŸš€ éƒ¨ç½²é…ç½®

### Docker Composeå®Œæ•´é…ç½®

åˆ›å»º `deployment/docker/docker-compose.yml`:

```yaml
version: '3.8'

services:
  mysql:
    image: mysql:8.0
    container_name: idata-mysql
    environment:
      MYSQL_ROOT_PASSWORD: root123
      MYSQL_DATABASE: idata_ai
    ports:
      - "3306:3306"
    volumes:
      - mysql-data:/var/lib/mysql
      - ../../database/schema:/docker-entrypoint-initdb.d
    networks:
      - idata-network

  redis:
    image: redis:7-alpine
    container_name: idata-redis
    ports:
      - "6379:6379"
    networks:
      - idata-network

  rabbitmq:
    image: rabbitmq:3.12-management
    container_name: idata-rabbitmq
    environment:
      RABBITMQ_DEFAULT_USER: admin
      RABBITMQ_DEFAULT_PASS: admin123
    ports:
      - "5672:5672"
      - "15672:15672"
    networks:
      - idata-network

  auth-service:
    build: ../../backend/idata-auth
    container_name: idata-auth
    ports:
      - "8081:8081"
    depends_on:
      - mysql
      - redis
    environment:
      SPRING_DATASOURCE_URL: jdbc:mysql://mysql:3306/idata_ai
      SPRING_REDIS_HOST: redis
    networks:
      - idata-network

  # å…¶ä»–æœåŠ¡ç±»ä¼¼é…ç½®...

  nginx:
    image: nginx:alpine
    container_name: idata-nginx
    ports:
      - "80:80"
    volumes:
      - ../nginx/nginx.conf:/etc/nginx/nginx.conf
      - ../../frontend/dist:/usr/share/nginx/html
    depends_on:
      - auth-service
    networks:
      - idata-network

volumes:
  mysql-data:

networks:
  idata-network:
    driver: bridge
```

### Nginxé…ç½®

åˆ›å»º `deployment/nginx/nginx.conf`:

```nginx
server {
    listen 80;
    server_name localhost;

    # å‰ç«¯
    location / {
        root /usr/share/nginx/html;
        try_files $uri $uri/ /index.html;
    }

    # åç«¯API
    location /api/ {
        proxy_pass http://auth-service:8081/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

## âœ… å¼€å‘æ£€æŸ¥æ¸…å•

### åç«¯æœåŠ¡æ£€æŸ¥

- [ ] å®ä½“ç±»ç»§æ‰¿BaseEntity
- [ ] Mapperç»§æ‰¿BaseMapper<T>
- [ ] Serviceä½¿ç”¨@Transactional
- [ ] Controllerä½¿ç”¨@RestController
- [ ] ç»Ÿä¸€å¼‚å¸¸å¤„ç†
- [ ] æ—¥å¿—è®°å½•
- [ ] å‚æ•°æ ¡éªŒ(@Valid)
- [ ] Redisç¼“å­˜
- [ ] å•å…ƒæµ‹è¯•

### å‰ç«¯å¼€å‘æ£€æŸ¥

- [ ] TypeScriptç±»å‹å®šä¹‰
- [ ] APIå°è£…
- [ ] é”™è¯¯å¤„ç†
- [ ] LoadingçŠ¶æ€
- [ ] è¡¨å•éªŒè¯
- [ ] å“åº”å¼è®¾è®¡
- [ ] ä»£ç æ ¼å¼åŒ–

## ğŸ“š å‚è€ƒèµ„æº

- [Spring Bootå®˜æ–¹æ–‡æ¡£](https://spring.io/projects/spring-boot)
- [MyBatis Plusæ–‡æ¡£](https://baomidou.com/)
- [Vue 3æ–‡æ¡£](https://vuejs.org/)
- [Element Plusæ–‡æ¡£](https://element-plus.org/)
- [TypeScriptæ–‡æ¡£](https://www.typescriptlang.org/)

---

**æç¤º**: æŒ‰ç…§ä¼˜å…ˆçº§é€æ­¥å®Œæˆå„ä¸ªæ¨¡å—,å…ˆå®Œæˆæ ¸å¿ƒåŠŸèƒ½,å†é€æ­¥æ‰©å±•ã€‚

---

## ğŸ“š å‚è€ƒèµ„æº

- [Spring Bootå®˜æ–¹æ–‡æ¡£](https://spring.io/projects/spring-boot)
- [MyBatis Plusæ–‡æ¡£](https://baomidou.com/)
- [Vue 3æ–‡æ¡£](https://vuejs.org/)
- [Element Plusæ–‡æ¡£](https://element-plus.org/)
- [TypeScriptæ–‡æ¡£](https://www.typescriptlang.org/)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v2.0  
**æ›´æ–°æ—¥æœŸ**: 2026-02-17
