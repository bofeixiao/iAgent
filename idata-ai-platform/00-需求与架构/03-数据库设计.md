# iData AI创作平台 - 数据库设计

## 1. 数据库概述

### 1.1 数据库信息
- **数据库名称**: `idata_ai`
- **字符集**: utf8mb4
- **排序规则**: utf8mb4_unicode_ci
- **引擎**: InnoDB
- **版本**: MySQL 8.0+

### 1.2 命名规范
- 表名: `t_{module}_{table}` (如: t_user, t_app_application)
- 字段名: 小写下划线命名 (如: user_name, create_time)
- 索引: `idx_{column1}_{column2}` (普通索引)
- 唯一索引: `uk_{column}` (unique key)
- 外键: `fk_{table}_{column}` (实际项目中不使用外键约束)

### 1.3 公共字段说明
所有业务表必须包含以下字段:
- `id`: BIGINT, 主键, 雪花算法生成
- `create_time`: DATETIME, 创建时间, 默认CURRENT_TIMESTAMP
- `update_time`: DATETIME, 更新时间, 默认CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
- `is_deleted`: TINYINT, 逻辑删除标记, 0-未删除, 1-已删除, 默认0
- `created_by`: BIGINT, 创建人ID (可选)
- `updated_by`: BIGINT, 更新人ID (可选)

## 2. 核心表设计

### 2.1 用户相关表

#### 2.1.1 用户表 (t_user)
```sql
CREATE TABLE `t_user` (
  `id` BIGINT NOT NULL COMMENT '用户ID',
  `username` VARCHAR(50) DEFAULT NULL COMMENT '用户名',
  `password` VARCHAR(255) NOT NULL COMMENT '密码(BCrypt加密)',
  `email` VARCHAR(100) DEFAULT NULL COMMENT '邮箱',
  `phone` VARCHAR(20) DEFAULT NULL COMMENT '手机号',
  `avatar_url` VARCHAR(500) DEFAULT NULL COMMENT '头像URL',
  `nickname` VARCHAR(50) DEFAULT NULL COMMENT '昵称',
  `gender` TINYINT DEFAULT 0 COMMENT '性别:0-未知,1-男,2-女',
  `birthday` DATE DEFAULT NULL COMMENT '生日',
  `industry` VARCHAR(50) DEFAULT NULL COMMENT '所属行业',
  `status` TINYINT DEFAULT 1 COMMENT '账号状态:0-禁用,1-正常',
  `vip_level` TINYINT DEFAULT 0 COMMENT 'VIP等级:0-普通,1-银卡,2-金卡,3-铂金卡',
  `vip_expire_time` DATETIME DEFAULT NULL COMMENT 'VIP到期时间',
  `credits` INT DEFAULT 5 COMMENT '积分余额',
  `last_login_time` DATETIME DEFAULT NULL COMMENT '最后登录时间',
  `last_login_ip` VARCHAR(50) DEFAULT NULL COMMENT '最后登录IP',
  `register_source` VARCHAR(20) DEFAULT 'web' COMMENT '注册来源:web,mobile,wechat',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `is_deleted` TINYINT DEFAULT 0 COMMENT '删除标记:0-未删除,1-已删除',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_email` (`email`),
  UNIQUE KEY `uk_phone` (`phone`),
  KEY `idx_username` (`username`),
  KEY `idx_vip_level` (`vip_level`),
  KEY `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='用户表';
```

#### 2.1.2 用户角色表 (t_user_role)
```sql
CREATE TABLE `t_user_role` (
  `id` BIGINT NOT NULL COMMENT 'ID',
  `user_id` BIGINT NOT NULL COMMENT '用户ID',
  `role_id` BIGINT NOT NULL COMMENT '角色ID',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_role_id` (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='用户角色关联表';
```

#### 2.1.3 角色表 (t_role)
```sql
CREATE TABLE `t_role` (
  `id` BIGINT NOT NULL COMMENT '角色ID',
  `role_name` VARCHAR(50) NOT NULL COMMENT '角色名称',
  `role_code` VARCHAR(50) NOT NULL COMMENT '角色编码',
  `description` VARCHAR(200) DEFAULT NULL COMMENT '角色描述',
  `status` TINYINT DEFAULT 1 COMMENT '状态:0-禁用,1-启用',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `is_deleted` TINYINT DEFAULT 0 COMMENT '删除标记',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_role_code` (`role_code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='角色表';
```

### 2.2 应用相关表

#### 2.2.1 应用表 (t_app_application)
```sql
CREATE TABLE `t_app_application` (
  `id` BIGINT NOT NULL COMMENT '应用ID',
  `app_name` VARCHAR(100) NOT NULL COMMENT '应用名称',
  `app_icon` VARCHAR(100) DEFAULT NULL COMMENT '应用图标(emoji或URL)',
  `description` TEXT COMMENT '应用描述',
  `category_id` BIGINT DEFAULT NULL COMMENT '分类ID',
  `app_type` VARCHAR(20) DEFAULT 'text' COMMENT '应用类型:text,image,video',
  `config_schema` JSON DEFAULT NULL COMMENT '配置Schema(JSON)',
  `input_fields` JSON NOT NULL COMMENT '输入字段配置(JSON)',
  `output_template` TEXT DEFAULT NULL COMMENT '输出模板',
  `ai_model` VARCHAR(50) DEFAULT 'gpt-3.5' COMMENT 'AI模型',
  `credits_cost` INT DEFAULT 1 COMMENT '消耗积分数',
  `status` TINYINT DEFAULT 1 COMMENT '状态:0-下架,1-上架',
  `is_hot` TINYINT DEFAULT 0 COMMENT '是否热门:0-否,1-是',
  `use_count` INT DEFAULT 0 COMMENT '使用次数',
  `sort_order` INT DEFAULT 0 COMMENT '排序号',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `is_deleted` TINYINT DEFAULT 0 COMMENT '删除标记',
  PRIMARY KEY (`id`),
  KEY `idx_category_id` (`category_id`),
  KEY `idx_app_type` (`app_type`),
  KEY `idx_is_hot` (`is_hot`),
  KEY `idx_use_count` (`use_count`),
  KEY idx_sort_order` (`sort_order`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='应用模板表';
```

#### 2.2.2 应用分类表 (t_app_category)
```sql
CREATE TABLE `t_app_category` (
  `id` BIGINT NOT NULL COMMENT '分类ID',
  `category_name` VARCHAR(50) NOT NULL COMMENT '分类名称',
  `parent_id` BIGINT DEFAULT 0 COMMENT '父分类ID,0表示顶级',
  `icon` VARCHAR(100) DEFAULT NULL COMMENT '分类图标',
  `sort_order` INT DEFAULT 0 COMMENT '排序号',
  `status` TINYINT DEFAULT 1 COMMENT '状态:0-禁用,1-启用',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `is_deleted` TINYINT DEFAULT 0 COMMENT '删除标记',
  PRIMARY KEY (`id`),
  KEY `idx_parent_id` (`parent_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='应用分类表';
```

### 2.3 作品实例表

#### 2.3.1 实例表 (t_app_instance)
```sql
CREATE TABLE `t_app_instance` (
  `id` BIGINT NOT NULL COMMENT '实例ID',
  `user_id` BIGINT NOT NULL COMMENT '用户ID',
  `app_id` BIGINT NOT NULL COMMENT '应用ID',
  `title` VARCHAR(200) DEFAULT NULL COMMENT '作品标题',
  `input_params` JSON NOT NULL COMMENT '输入参数(JSON)',
  `output_result` TEXT DEFAULT NULL COMMENT '输出结果',
  `output_files` JSON DEFAULT NULL COMMENT '输出文件列表(JSON)',
  `status` TINYINT DEFAULT 0 COMMENT '状态:0-处理中,1-成功,2-失败',
  `error_message` TEXT DEFAULT NULL COMMENT '错误信息',
  `credits_cost` INT DEFAULT 0 COMMENT '实际消耗积分',
  `processing_time` INT DEFAULT 0 COMMENT '处理耗时(秒)',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `is_deleted` TINYINT DEFAULT 0 COMMENT '删除标记',
  PRIMARY KEY (`id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_app_id` (`app_id`),
  KEY `idx_create_time` (`create_time`),
  KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='应用实例表(用户作品)';
```

### 2.4 内容相关表

#### 2.4.1 文章表 (t_content_article)
```sql
CREATE TABLE `t_content_article` (
  `id` BIGINT NOT NULL COMMENT '文章ID',
  `title` VARCHAR(200) NOT NULL COMMENT '文章标题',
  `summary` VARCHAR(500) DEFAULT NULL COMMENT '文章摘要',
  `content` TEXT NOT NULL COMMENT '文章内容(Markdown)',
  `author_id` BIGINT NOT NULL COMMENT '作者ID',
  `cover_image` VARCHAR(500) DEFAULT NULL COMMENT '封面图片',
  `category` VARCHAR(50) DEFAULT NULL COMMENT '分类',
  `tags` VARCHAR(200) DEFAULT NULL COMMENT '标签,逗号分隔',
  `view_count` INT DEFAULT 0 COMMENT '浏览次数',
  `like_count` INT DEFAULT 0 COMMENT '点赞次数',
  `comment_count` INT DEFAULT 0 COMMENT '评论次数',
  `is_featured` TINYINT DEFAULT 0 COMMENT '是否精华:0-否,1-是',
  `is_published` TINYINT DEFAULT 0 COMMENT '是否发布:0-草稿,1-已发布',
  `publish_time` DATETIME DEFAULT NULL COMMENT '发布时间',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `is_deleted` TINYINT DEFAULT 0 COMMENT '删除标记',
  PRIMARY KEY (`id`),
  KEY `idx_author_id` (`author_id`),
  KEY `idx_is_featured` (`is_featured`),
  KEY `idx_is_published` (`is_published`),
  KEY `idx_publish_time` (`publish_time`),
  KEY `idx_view_count` (`view_count`),
  FULLTEXT KEY `ft_title_content` (`title`, `content`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='文章表';
```

#### 2.4.2 思维表 (t_content_thinking)
```sql
CREATE TABLE `t_content_thinking` (
  `id` BIGINT NOT NULL COMMENT '思维ID',
  `user_id` BIGINT NOT NULL COMMENT '用户ID',
  `industry` VARCHAR(50) DEFAULT NULL COMMENT '所属行业',
  `is_insurance_industry` TINYINT DEFAULT 0 COMMENT '是否保险行业:0-否,1-是',
  `media_status` TINYINT DEFAULT 0 COMMENT '自媒体情况:0-未做,1-在做但未变现,2-在做已变现,3-想做不知如何开始,4-专注线下私域',
  `questionnaire_answers` JSON DEFAULT NULL COMMENT '问卷回答(JSON)',
  `writing_style` TEXT DEFAULT NULL COMMENT 'AI分析的写作风格',
  `resources` JSON DEFAULT NULL COMMENT '关联资源列表(JSON)',
  `status` TINYINT DEFAULT 0 COMMENT '状态:0-未完成,1-已提交,2-已分析',
  `analyzed_time` DATETIME DEFAULT NULL COMMENT '分析完成时间',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `is_deleted` TINYINT DEFAULT 0 COMMENT '删除标记',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_user_id` (`user_id`),
  KEY `idx_status` (`status`),
  KEY `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='用户思维表';
```

### 2.5 支付相关表

#### 2.5.1 会员等级表 (t_payment_membership_level)
```sql
CREATE TABLE `t_payment_membership_level` (
  `id` BIGINT NOT NULL COMMENT '等级ID',
  `level_code` VARCHAR(20) NOT NULL COMMENT '等级编码',
  `level_name` VARCHAR(50) NOT NULL COMMENT '等级名称',
  `level_value` TINYINT NOT NULL COMMENT '等级值:0-普通,1-银卡,2-金卡,3-铂金卡',
  `price` DECIMAL(10,2) NOT NULL COMMENT '价格(元)',
  `duration_days` INT NOT NULL COMMENT '有效期(天)',
  `credits_gift` INT DEFAULT 0 COMMENT '赠送积分',
  `benefits` JSON DEFAULT NULL COMMENT '权益描述(JSON)',
  `sort_order` INT DEFAULT 0 COMMENT '排序号',
  `status` TINYINT DEFAULT 1 COMMENT '状态:0-下架,1-上架',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `is_deleted` TINYINT DEFAULT 0 COMMENT '删除标记',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_level_code` (`level_code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='会员等级表';
```

#### 2.5.2 积分记录表 (t_payment_credit_log)
```sql
CREATE TABLE `t_payment_credit_log` (
  `id` BIGINT NOT NULL COMMENT '记录ID',
  `user_id` BIGINT NOT NULL COMMENT '用户ID',
  `change_type` TINYINT NOT NULL COMMENT '变动类型:1-充值,2-消费,3-赠送,4-退款,5-系统调整',
  `change_amount` INT NOT NULL COMMENT '变动积分(正数增加,负数减少)',
  `balance_before` INT NOT NULL COMMENT '变动前余额',
  `balance_after` INT NOT NULL COMMENT '变动后余额',
  `related_id` BIGINT DEFAULT NULL COMMENT '关联ID(订单ID/实例ID等)',
  `related_type` VARCHAR(20) DEFAULT NULL COMMENT '关联类型:order,instance',
  `remark` VARCHAR(200) DEFAULT NULL COMMENT '备注',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_change_type` (`change_type`),
  KEY `idx_create_time` (`create_time`),
  KEY `idx_related` (`related_id`, `related_type`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='积分记录表';
```

#### 2.5.3 订单表 (t_payment_order)
```sql
CREATE TABLE `t_payment_order` (
  `id` BIGINT NOT NULL COMMENT '订单ID',
  `order_no` VARCHAR(32) NOT NULL COMMENT '订单号',
  `user_id` BIGINT NOT NULL COMMENT '用户ID',
  `order_type` TINYINT NOT NULL COMMENT '订单类型:1-会员购买,2-积分充值',
  `product_id` BIGINT DEFAULT NULL COMMENT '产品ID',
  `product_name` VARCHAR(100) NOT NULL COMMENT '产品名称',
  `quantity` INT DEFAULT 1 COMMENT '数量',
  `original_amount` DECIMAL(10,2) NOT NULL COMMENT '原价',
  `discount_amount` DECIMAL(10,2) DEFAULT 0.00 COMMENT '优惠金额',
  `payable_amount` DECIMAL(10,2) NOT NULL COMMENT '应付金额',
  `actual_amount` DECIMAL(10,2) DEFAULT 0.00 COMMENT '实付金额',
  `payment_method` VARCHAR(20) DEFAULT NULL COMMENT '支付方式:alipay,wechat,balance',
  `payment_time` DATETIME DEFAULT NULL COMMENT '支付时间',
  `third_party_order_no` VARCHAR(64) DEFAULT NULL COMMENT '第三方订单号',
  `status` TINYINT DEFAULT 0 COMMENT '订单状态:0-待支付,1-已支付,2-已取消,3-已退款',
  `expire_time` DATETIME DEFAULT NULL COMMENT '订单过期时间',
  `cancel_reason` VARCHAR(200) DEFAULT NULL COMMENT '取消原因',
  `remark` VARCHAR(500) DEFAULT NULL COMMENT '备注',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `is_deleted` TINYINT DEFAULT 0 COMMENT '删除标记',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_order_no` (`order_no`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_order_type` (`order_type`),
  KEY `idx_status` (`status`),
  KEY `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='订单表';
```

#### 2.5.4 优惠券表 (t_payment_coupon)
```sql
CREATE TABLE `t_payment_coupon` (
  `id` BIGINT NOT NULL COMMENT '优惠券ID',
  `coupon_code` VARCHAR(32) NOT NULL COMMENT '优惠券编码',
  `coupon_name` VARCHAR(100) NOT NULL COMMENT '优惠券名称',
  `coupon_type` TINYINT NOT NULL COMMENT '类型:1-满减,2-折扣,3-抵扣',
  `discount_value` DECIMAL(10,2) NOT NULL COMMENT '优惠值',
  `min_amount` DECIMAL(10,2) DEFAULT 0.00 COMMENT '最低消费金额',
  `max_discount` DECIMAL(10,2) DEFAULT NULL COMMENT '最大优惠金额',
  `valid_from` DATETIME NOT NULL COMMENT '有效期开始',
  `valid_until` DATETIME NOT NULL COMMENT '有效期结束',
  `total_quantity` INT DEFAULT NULL COMMENT '总数量,NULL表示无限',
  `used_quantity` INT DEFAULT 0 COMMENT '已使用数量',
  `status` TINYINT DEFAULT 1 COMMENT '状态:0-禁用,1-启用',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `is_deleted` TINYINT DEFAULT 0 COMMENT '删除标记',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_coupon_code` (`coupon_code`),
  KEY `idx_valid_from` (`valid_from`),
  KEY `idx_valid_until` (`valid_until`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='优惠券表';
```

### 2.6 营销相关表

#### 2.6.1 活动表 (t_marketing_campaign)
```sql
CREATE TABLE `t_marketing_campaign` (
  `id` BIGINT NOT NULL COMMENT '活动ID',
  `campaign_name` VARCHAR(100) NOT NULL COMMENT '活动名称',
  `campaign_type` VARCHAR(20) NOT NULL COMMENT '活动类型:banner,invite,festival',
  `title` VARCHAR(200) NOT NULL COMMENT '活动标题',
  `subtitle` VARCHAR(200) DEFAULT NULL COMMENT '副标题',
  `banner_image` VARCHAR(500) DEFAULT NULL COMMENT 'Banner图片',
  `content` TEXT DEFAULT NULL COMMENT '活动内容',
  `link_url` VARCHAR(500) DEFAULT NULL COMMENT '跳转链接',
  `start_time` DATETIME NOT NULL COMMENT '开始时间',
  `end_time` DATETIME NOT NULL COMMENT '结束时间',
  `status` TINYINT DEFAULT 1 COMMENT '状态:0-禁用,1-启用',
  `sort_order` INT DEFAULT 0 COMMENT '排序号',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  `is_deleted` TINYINT DEFAULT 0 COMMENT '删除标记',
  PRIMARY KEY (`id`),
  KEY `idx_campaign_type` (`campaign_type`),
  KEY `idx_start_time` (`start_time`),
  KEY `idx_end_time` (`end_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='营销活动表';
```

#### 2.6.2 邀请记录表 (t_marketing_invitation)
```sql
CREATE TABLE `t_marketing_invitation` (
  `id` BIGINT NOT NULL COMMENT '记录ID',
  `inviter_id` BIGINT NOT NULL COMMENT '邀请人ID',
  `invitee_id` BIGINT NOT NULL COMMENT '被邀请人ID',
  `invitation_code` VARCHAR(32) NOT NULL COMMENT '邀请码',
  `reward_type` TINYINT DEFAULT 1 COMMENT '奖励类型:1-积分,2-优惠券',
  `reward_value` INT DEFAULT 0 COMMENT '奖励值',
  `reward_status` TINYINT DEFAULT 0 COMMENT '奖励状态:0-待发放,1-已发放',
  `reward_time` DATETIME DEFAULT NULL COMMENT '奖励发放时间',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`id`),
  KEY `idx_inviter_id` (`inviter_id`),
  KEY `idx_invitee_id` (`invitee_id`),
  KEY `idx_invitation_code` (`invitation_code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='邀请记录表';
```

#### 2.6.3 热点趋势表 (t_marketing_trending)
```sql
CREATE TABLE `t_marketing_trending` (
  `id` BIGINT NOT NULL COMMENT '热点ID',
  `title` VARCHAR(200) NOT NULL COMMENT '热点标题',
  `summary` VARCHAR(500) DEFAULT NULL COMMENT '热点摘要',
  `source` VARCHAR(20) NOT NULL COMMENT '来源:douyin,wechat,toutiao,zhihu,weibo',
  `source_color` VARCHAR(20) DEFAULT NULL COMMENT '来源颜色(Hex)',
  `hot_value` BIGINT DEFAULT 0 COMMENT '热度值',
  `link_url` VARCHAR(500) DEFAULT NULL COMMENT '原文链接',
  `publish_time` DATETIME NOT NULL COMMENT '发布时间',
  `status` TINYINT DEFAULT 1 COMMENT '状态:0-下架,1-上架',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  KEY `idx_source` (`source`),
  KEY `idx_hot_value` (`hot_value`),
  KEY `idx_publish_time` (`publish_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='热点趋势表';
```

### 2.7 系统相关表

#### 2.7.1 系统配置表 (t_sys_config)
```sql
CREATE TABLE `t_sys_config` (
  `id` BIGINT NOT NULL COMMENT '配置ID',
  `config_key` VARCHAR(50) NOT NULL COMMENT '配置键',
  `config_value` TEXT NOT NULL COMMENT '配置值',
  `config_type` VARCHAR(20) DEFAULT 'string' COMMENT '配置类型:string,number,boolean,json',
  `description` VARCHAR(200) DEFAULT NULL COMMENT '配置描述',
  `group_name` VARCHAR(50) DEFAULT 'default' COMMENT '配置分组',
  `is_editable` TINYINT DEFAULT 1 COMMENT '是否可编辑:0-否,1-是',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_config_key` (`config_key`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='系统配置表';
```

#### 2.7.2 操作日志表 (t_sys_log)
```sql
CREATE TABLE `t_sys_log` (
  `id` BIGINT NOT NULL COMMENT '日志ID',
  `user_id` BIGINT DEFAULT NULL COMMENT '用户ID',
  `username` VARCHAR(50) DEFAULT NULL COMMENT '用户名',
  `operation` VARCHAR(100) NOT NULL COMMENT '操作描述',
  `method` VARCHAR(200) DEFAULT NULL COMMENT '请求方法',
  `params` TEXT DEFAULT NULL COMMENT '请求参数',
  `ip` VARCHAR(50) DEFAULT NULL COMMENT 'IP地址',
  `user_agent` VARCHAR(500) DEFAULT NULL COMMENT 'User Agent',
  `execute_time` INT DEFAULT 0 COMMENT '执行时间(ms)',
  `status` TINYINT DEFAULT 1 COMMENT '状态:0-失败,1-成功',
  `error_message` TEXT DEFAULT NULL COMMENT '错误信息',
  `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  PRIMARY KEY (`id`),
  KEY `idx_user_id` (`user_id`),
  KEY `idx_create_time` (`create_time`),
  KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='操作日志表';
```

## 3. 数据库初始化SQL

### 3.1 初始化数据

```sql
-- 插入默认会员等级
INSERT INTO `t_payment_membership_level` (`id`, `level_code`, `level_name`, `level_value`, `price`, `duration_days`, `credits_gift`, `benefits`, `sort_order`, `status`) VALUES
(1, 'BASIC', '普通用户', 0, 0.00, 0, 5, '{"features": ["基础AI应用", "5积分/注册"]}', 0, 1),
(2, 'SILVER', '银卡会员', 1, 99.00, 30, 100, '{"features": ["全部AI应用", "100积分月卡", "优先客服"]}', 1, 1),
(3, 'GOLD', '金卡会员', 2, 499.00, 180, 600, '{"features": ["全部AI应用", "600积分半年卡", "优先客服", "专属应用"]}', 2, 1),
(4, 'PLATINUM', '铂金会员', 3, 999.00, 365, 1500, '{"features": ["全部AI应用", "1500积分年卡", "VIP客服", "专属应用", "高级功能"]}', 3, 1);

-- 插入默认角色
INSERT INTO `t_role` (`id`, `role_name`, `role_code`, `description`, `status`) VALUES
(1, '超级管理员', 'SUPER_ADMIN', '拥有所有权限', 1),
(2, '管理员', 'ADMIN', '管理员权限', 1),
(3, '普通用户', 'USER', '普通用户权限', 1);

-- 插入系统配置
INSERT INTO `t_sys_config` (`id`, `config_key`, `config_value`, `config_type`, `description`, `group_name`) VALUES
(1, 'system.name', 'iData AI创作平台', 'string', '系统名称', 'system'),
(2, 'register.default_credits', '5', 'number', '注册赠送积分', 'user'),
(3, 'ai.default_model', 'gpt-3.5-turbo', 'string', '默认AI模型', 'ai'),
(4, 'thinking.quota_per_month', '5', 'number', '30天内思维创建配额', 'thinking');
```

## 4. 索引优化建议

### 4.1 高频查询索引
- 用户表: email, phone, username, vip_level
- 应用表: category_id, is_hot, use_count
- 实例表: user_id, app_id, create_time, status
- 文章表: author_id, is_featured, publish_time
- 积分记录: user_id, create_time

### 4.2 组合索引
```sql
-- 应用列表查询(分类+热门+排序)
ALTER TABLE `t_app_application` 
ADD INDEX `idx_category_hot_sort` (`category_id`, `is_hot`, `sort_order`);

-- 用户作品查询(用户+时间)
ALTER TABLE `t_app_instance` 
ADD INDEX `idx_user_create` (`user_id`, `create_time`);

-- 文章列表查询(发布+精华+时间)
ALTER TABLE `t_content_article` 
ADD INDEX `idx_publish_featured_time` (`is_published`, `is_featured`, `publish_time`);
```

## 5. 分表分库策略

### 5.1 分表策略
当数据量达到以下阈值时考虑分表:
- **作品实例表**: 单表500万条，按user_id取模分16表
- **积分记录表**: 单表1000万条，按create_time按月分表
- **操作日志表**: 单表2000万条，按create_time按月分表

### 5.2 分库策略
- 读写分离: 主库(写) + 从库(读)
- 垂直分库: 业务模块独立数据库

## 6. 备份与恢复

### 6.1 备份策略
- **全量备份**: 每天凌晨3:00执行
- **增量备份**: 每4小时执行一次
- **binlog备份**: 实时同步

### 6.2 备份命令
```bash
# 全量备份
mysqldump -u root -p --single-transaction --master-data=2 \
  --databases idata_ai > idata_ai_$(date +%Y%m%d).sql

# 恢复
mysql -u root -p idata_ai < idata_ai_20260215.sql
```

---

**文档版本**: v1.0  
**编制日期**: 2026-02-15  
**编制人**: iDataAI团队
