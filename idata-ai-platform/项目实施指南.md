# iData AI Platform - 项目实施指南

## 项目概述

iData AI创作平台是一个完整的AI创作服务系统，采用前后端分离架构，支持1000并发用户。

**技术栈**:
- 后端: Java 17 + Spring Boot 3.2.2 + MyBatis Plus 3.5.5
- 前端: Vue 3.4.19 + TypeScript + Element Plus
- 数据库: MySQL 8.0 + Redis 7.x
- 消息队列: RabbitMQ 3.12
- 部署: Docker + Nginx

## 一、环境准备

### 1.1 必需软件

```bash
# Java 17
java -version

# Maven 3.8+
mvn -version

# Node.js 18+
node -v

# Docker 24+
docker -v

# MySQL 8.0
mysql --version

# Redis 7.x
redis-server --version

# RabbitMQ 3.12
rabbitmq-server
```

### 1.2 数据库初始化

```bash
# 1. 创建数据库
mysql -u root -p
CREATE DATABASE idata_ai CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

# 2. 执行建表脚本
cd database/schema
mysql -u root -p idata_ai < init.sql
mysql -u root -p idata_ai < 02_additional_tables.sql

# 3. 插入示例数据
cd ../data
mysql -u root -p idata_ai < sample_data.sql
```

### 1.3 Redis配置

```bash
# 启动Redis
redis-server

# 测试连接
redis-cli ping
# 应返回: PONG
```

### 1.4 RabbitMQ配置

```bash
# 启动RabbitMQ
rabbitmq-server

# 启用管理插件
rabbitmq-plugins enable rabbitmq_management

# 访问管理界面: http://localhost:15672
# 默认账号: guest/guest
```

## 二、后端服务部署

### 2.1 项目结构

```
backend/
├── idata-common/          # 公共模块（工具类、异常、配置）
├── idata-gateway/         # API网关（未实现，预留）
├── idata-auth/            # 认证服务 (端口8081)
├── idata-system/          # 系统管理服务 (端口8082)
├── idata-app/             # 应用服务 (端口8083)
├── idata-content/         # 内容服务 (端口8084)
├── idata-payment/         # 支付服务 (端口8085)
├── idata-ai/              # AI服务（未实现，预留）
└── idata-marketing/       # 营销服务 (端口8087)
```

### 2.2 配置修改

每个服务的 `application.yml` 需要根据实际环境修改：

```yaml
# 示例: idata-auth/src/main/resources/application.yml

spring:
  datasource:
    url: jdbc:mysql://localhost:3306/idata_ai?...
    username: root
    password: your_password  # 修改为实际密码
  
  redis:
    host: localhost          # 修改为实际Redis地址
    port: 6379
  
  rabbitmq:
    host: localhost          # 修改为实际RabbitMQ地址
    port: 5672
    username: guest          # 修改为实际账户
    password: guest          # 修改为实际密码

# JWT密钥（必须修改！）
jwt:
  secret: your-very-secure-secret-key-at-least-32-characters-long
```

### 2.3 编译打包

```bash
cd backend

# 编译所有模块
mvn clean package -DskipTests

# 各服务的JAR文件位置:
# idata-auth/target/idata-auth-1.0.0.jar
# idata-system/target/idata-system-1.0.0.jar
# idata-app/target/idata-app-1.0.0.jar
# ...
```

### 2.4 启动服务

**方式1: 直接运行**

```bash
# 认证服务
java -jar idata-auth/target/idata-auth-1.0.0.jar

# 系统管理服务
java -jar idata-system/target/idata-system-1.0.0.jar

# 应用服务
java -jar idata-app/target/idata-app-1.0.0.jar

# 内容服务
java -jar idata-content/target/idata-content-1.0.0.jar

# 支付服务
java -jar idata-payment/target/idata-payment-1.0.0.jar

# 营销服务
java -jar idata-marketing/target/idata-marketing-1.0.0.jar
```

**方式2: 后台运行**

```bash
# 后台运行并输出日志
nohup java -jar idata-auth/target/idata-auth-1.0.0.jar > auth.log 2>&1 &
nohup java -jar idata-system/target/idata-system-1.0.0.jar > system.log 2>&1 &
# ... 其他服务类似
```

### 2.5 服务验证

```bash
# 检查认证服务
curl http://localhost:8081/api/auth/login

# 检查系统管理服务
curl http://localhost:8082/api/user/list

# 检查应用服务
curl http://localhost:8083/api/application/list

# 检查所有服务的健康状态
ps aux | grep idata
```

## 三、前端部署

### 3.1 安装依赖

```bash
cd qshan-ai-platform

# 安装依赖
npm install
```

### 3.2 配置修改

修改 `vite.config.ts` 中的代理配置：

```typescript
server: {
  proxy: {
    '/api': {
      target: 'http://localhost:8080',  // 修改为实际后端地址
      changeOrigin: true
    }
  }
}
```

### 3.3 开发模式运行

```bash
npm run dev

# 访问: http://localhost:5173
```

### 3.4 生产环境打包

```bash
# 打包
npm run build

# 打包后的文件在 dist/ 目录
```

### 3.5 Nginx部署

创建 Nginx配置文件 `/etc/nginx/conf.d/idata-ai.conf`:

```nginx
server {
    listen 80;
    server_name your-domain.com;

    # 前端静态文件
    location / {
        root /var/www/idata-ai/dist;
        try_files $uri $uri/ /index.html;
    }

    # API代理到后端服务
    location /api/auth/ {
        proxy_pass http://localhost:8081;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    location /api/user/ {
        proxy_pass http://localhost:8082;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    location /api/application/ {
        proxy_pass http://localhost:8083;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    location /api/instance/ {
        proxy_pass http://localhost:8083;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    location /api/article/ {
        proxy_pass http://localhost:8084;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    location /api/thinking/ {
        proxy_pass http://localhost:8084;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    location /api/order/ {
        proxy_pass http://localhost:8085;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    location /api/credit/ {
        proxy_pass http://localhost:8085;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    location /api/trending/ {
        proxy_pass http://localhost:8087;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    location /api/invitation/ {
        proxy_pass http://localhost:8087;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

部署前端文件：

```bash
# 复制打包文件到Nginx目录
mkdir -p /var/www/idata-ai
cp -r dist/* /var/www/idata-ai/

# 重启Nginx
nginx -t
nginx -s reload
```

## 四、Docker部署（推荐）

### 4.1 构建后端镜像

为每个服务创建 Dockerfile（示例：idata-auth）：

```dockerfile
# backend/idata-auth/Dockerfile
FROM openjdk:17-slim
WORKDIR /app
COPY target/idata-auth-1.0.0.jar app.jar
EXPOSE 8081
ENTRYPOINT ["java", "-jar", "app.jar"]
```

构建镜像：

```bash
cd backend/idata-auth
docker build -t idata-auth:1.0.0 .
```

### 4.2 构建前端镜像

```dockerfile
# qshan-ai-platform/Dockerfile
FROM node:18 AS build
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build

FROM nginx:alpine
COPY --from=build /app/dist /usr/share/nginx/html
COPY nginx.conf /etc/nginx/conf.d/default.conf
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
```

### 4.3 Docker Compose部署

创建 `docker-compose.yml`:

```yaml
version: '3.8'

services:
  mysql:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_DATABASE: idata_ai
    ports:
      - "3306:3306"
    volumes:
      - ./database/schema:/docker-entrypoint-initdb.d
      - mysql-data:/var/lib/mysql

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"

  rabbitmq:
    image: rabbitmq:3.12-management
    ports:
      - "5672:5672"
      - "15672:15672"

  auth-service:
    image: idata-auth:1.0.0
    ports:
      - "8081:8081"
    depends_on:
      - mysql
      - redis

  system-service:
    image: idata-system:1.0.0
    ports:
      - "8082:8082"
    depends_on:
      - mysql
      - redis

  app-service:
    image: idata-app:1.0.0
    ports:
      - "8083:8083"
    depends_on:
      - mysql
      - redis
      - rabbitmq

  content-service:
    image: idata-content:1.0.0
    ports:
      - "8084:8084"
    depends_on:
      - mysql
      - redis

  payment-service:
    image: idata-payment:1.0.0
    ports:
      - "8085:8085"
    depends_on:
      - mysql
      - redis

  marketing-service:
    image: idata-marketing:1.0.0
    ports:
      - "8087:8087"
    depends_on:
      - mysql
      - redis

  frontend:
    image: idata-frontend:1.0.0
    ports:
      - "80:80"
    depends_on:
      - auth-service
      - system-service
      - app-service

volumes:
  mysql-data:
```

启动所有服务：

```bash
docker-compose up -d

# 查看日志
docker-compose logs -f

# 停止服务
docker-compose down
```

## 五、功能测试

### 5.1 用户注册和登录

```bash
# 注册
curl -X POST http://localhost:8081/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "test@example.com",
    "phone": "13800138000",
    "password": "Test1234"
  }'

# 登录
curl -X POST http://localhost:8081/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "account": "test@example.com",
    "password": "Test1234"
  }'
```

### 5.2 应用列表查询

```bash
# 获取应用列表
curl http://localhost:8083/api/application/list?pageNum=1&pageSize=10

# 获取热门应用
curl http://localhost:8083/api/application/hot
```

### 5.3 创建应用实例

```bash
# 创建实例（需要带token）
curl -X POST http://localhost:8083/api/instance/create \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "appId": 1,
    "instanceName": "我的第一个作品",
    "inputParams": {
      "style": "幻想",
      "theme": "未来"
    }
  }'
```

## 六、已实现功能清单

### 后端服务

✅ **认证服务 (idata-auth:8081)**
- 用户注册（邮箱/手机号验证）
- 用户登录（支持邮箱/手机号/用户名）
- 退出登录
- Token刷新
- 获取用户信息（Redis缓存）

✅ **系统管理服务 (idata-system:8082)**
- 用户列表查询（分页、条件筛选）
- 用户详情查询（Redis缓存）
- 用户信息更新
- 用户状态管理
- 用户删除（逻辑删除）

✅ **应用服务 (idata-app:8083)**
- 应用列表查询（分页、分类、搜索）
- 应用详情查询
- 热门应用推荐
- 推荐应用列表
- 创建应用实例（异步MQ处理）
- 我的实例列表
- 实例详情查询
- 实例删除
- RabbitMQ消息生产/消费

✅ **内容服务 (idata-content:8084)**
- 文章列表查询接口
- 文章详情接口
- 思维分析接口
- 基础实体和Controller

✅ **支付服务 (idata-payment:8085)**
- 订单创建接口
- 订单查询接口
- 积分余额查询
- 积分充值接口
- 基础实体和Controller

✅ **营销服务 (idata-marketing:8087)**
- 热点列表查询
- 邀请码生成接口
- 使用邀请码接口
- 基础实体和Controller

### 前端页面

✅ **布局组件**
- DefaultLayout（主布局）
- Header（导航栏 + 用户信息 + 积分显示）
- Footer（底部信息）

✅ **核心页面 **
- 登录/注册页面（表单验证）
- 首页（轮播图 + 热门应用 + 精华内容）
- 应用列表页（分类筛选 + 搜索）

✅ **数据库表**
- 用户表（t_user）
- 角色表（t_role）
- 用户角色关联表（t_user_role）
- 应用分类表（t_app_category）
- 应用模板表（t_app_application）
- 应用实例表（t_app_instance）
- 会员级别表（t_payment_membership_level）
- 文章表（t_content_article）
- 思维分析表（t_content_thinking）
- 订单表（t_payment_order）
- 积分流水表（t_payment_credit_log）
- 优惠券表（t_payment_coupon）
- 营销活动表（t_marketing_campaign）
- 邀请记录表（t_marketing_invitation）
- 热点表（t_marketing_trending）
- 系统配置表（t_sys_config）
- 系统日志表（t_sys_log）

## 七、待开发功能

### 高优先级

1. **AI服务集成**
   - OpenAI API调用
   - AI任务异步处理
   - 结果回调更新

2. **完善业务逻辑**
   - 积分扣减和充值
   - 会员权益管理
   - 订单支付流程

3. **前端完善**
   - 业务组件（AppCard、InstanceCard、VipBadge等）
   - 剩余页面（作品列表、思维分析、文章列表、个人中心）
   - API集成和数据联调

### 中优先级

4. **API网关**
   - Spring Cloud Gateway配置
   - 统一路由和负载均衡
   - 限流和熔断

5. **监控和日志**
   - Prometheus + Grafana
   - ELK日志收集
   - SkyWalking链路追踪

### 低优先级

6. **性能优化**
   - Redis集群
   - MySQL读写分离
   - 静态资源CDN

7. **扩展功能**
   - 第三方登录
   - 实时通知（WebSocket）
   - 数据统计和报表

## 八、常见问题

### Q1: 启动服务报数据库连接失败

检查MySQL是否启动，用户名密码是否正确，数据库是否已创建。

### Q2: Redis连接失败

检查Redis是否启动，端口是否正确。

### Q3: RabbitMQ连接失败

检查RabbitMQ是否启动，用户名密码是否正确。

### Q4: 前端代理404

检查后端服务是否启动，Nginx配置是否正确。

### Q5: JWT Token过期

Token默认7天过期，可在配置文件中修改过期时间。

## 九、联系方式

- 项目文档：见 `00-需求与架构/`目录
- 部署文档：见 `docs/deployment/`目录
- 开发指南：见 `后续开发指南.md`

---

**祝您部署顺利！**
